#! /bin/bash

set -eu

eval $(gfarm-s3-readconf)

threads=2
workers=1

TIMEOUT=180

#RELOAD="--reload"
RELOAD=""

loglevel=$(echo "$GFARM_S3_LOG_LEVEL" | tr [:upper:] [:lower:])

exec "${GUNICORN_DIR}/bin/gunicorn" \
     --log-level "$loglevel" \
     --error-logfile - \
     --capture-output \
     --threads $threads \
     --workers $workers \
     --bind "$WEBUI_ADDR" \
     --chdir "$WEBUI_BASEDIR" \
     --timeout $TIMEOUT \
     $RELOAD \
     gfarms3.wsgi:application
